<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>国庆倒计时</title>
  <style>
    :root { --c1:#e6eef5; --c2:#c9d6e3; --c3:#aeb9c6; --text:#1b1f23; --muted:#5b6570; --card-bg:rgba(255,255,255,.55); --card-stroke:rgba(0,0,0,.06); --shadow:0 10px 30px rgba(15,23,42,.10); --accent:#5a6b7a; }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"PingFang SC","Noto Sans CJK SC","Microsoft Yahei",Helvetica,Arial; color:var(--text); background:linear-gradient(160deg,var(--c1),var(--c2),var(--c3)); background-size:200% 200%; animation:bg 18s ease-in-out infinite}
    @keyframes bg{0%{background-position:0 50%}50%{background-position:100% 50%}100%{background-position:0 50%}}
    @media(prefers-reduced-motion:reduce){body{animation:none}}

    .wrap{min-height:100%;display:grid;grid-template-rows:auto 1fr}
    header{position:relative;padding:16px 20px;display:flex;align-items:center;justify-content:center}
    header h1{margin:0;font-size:clamp(18px,2.6vw,28px);font-weight:800;letter-spacing:.4px}

    /* 右上角主题按钮 */
    #btn-theme{position:absolute;right:20px;top:12px;appearance:none;border:1px solid var(--card-stroke);background:rgba(255,255,255,.7);border-radius:12px;padding:8px 10px;cursor:pointer;box-shadow:var(--shadow);display:inline-flex;align-items:center;gap:8px}
    #btn-theme:hover{filter:brightness(.98)}
    .icon{width:18px;height:18px}

    .card{width:min(980px,92vw);margin:18px auto;background:var(--card-bg);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border:1px solid var(--card-stroke);border-radius:20px;box-shadow:var(--shadow);padding:clamp(16px,2.4vw,28px)}

    .topline{display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:10px;flex-wrap:nowrap;overflow:hidden}
    .range{color:var(--muted);font-size:14px;display:flex;flex-wrap:wrap;gap:10px 16px;flex:1 1 auto;min-width:0}
    .badge{flex:0 0 auto;display:inline-flex;align-items:center;justify-content:center;white-space:nowrap;padding:6px 10px;border-radius:999px;background:rgba(0,0,0,.06);color:var(--accent);border:1px solid var(--card-stroke)}

    .countdown{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:clamp(8px,2vw,16px);align-items:stretch;margin:8px 0 18px}
    .unit{background:rgba(255,255,255,.6);border:1px solid var(--card-stroke);border-radius:16px;padding:clamp(12px,2vw,18px);display:grid;grid-template-rows:1fr auto;place-items:center;min-height:110px}
    .num{font-variant-numeric:tabular-nums;font-feature-settings:"tnum" on; font-weight:800;font-size:clamp(28px,7vw,64px)}
    .label{color:var(--muted);font-size:13px;letter-spacing:.2px}

    .progress{margin:6px 0 2px}
    .bar{position:relative;height:14px;background:rgba(255,255,255,.65);border:1px solid var(--card-stroke);border-radius:999px;overflow:hidden}
    .fill{height:100%;width:0;background:linear-gradient(90deg,rgba(120,144,156,.9),rgba(96,125,139,.95));border-right:1px solid rgba(0,0,0,.05);transition:width .6s ease}
    .meta{margin-top:8px;display:flex;flex-wrap:wrap;align-items:center;gap:10px 16px;font-size:13px;color:var(--muted)} .meta strong{color:var(--text)}

    .grid{margin-top:22px;display:grid;grid-template-columns:1fr;gap:clamp(14px,2.4vw,22px)}
    .panel{background:rgba(255,255,255,.6);border:1px solid var(--card-stroke);border-radius:16px;padding:clamp(12px,2vw,18px)}
    .ring-wrap{display:flex;align-items:center;justify-content:center;padding:8px 0}
    .ring{width:clamp(140px,28vw,240px);height:auto;display:block}
    .ring text{font-variant-numeric:tabular-nums;font-weight:700;fill:var(--accent)}

    /* 右上角弹出层：小方框 + 纵向列表 + 文本在颜色块内 + 点随主题色 */
    .popover{position:fixed;z-index:20;min-width:240px;max-width:92vw;background:rgba(255,255,255,.96);border:1px solid var(--card-stroke);border-radius:12px;box-shadow:0 12px 40px rgba(15,23,42,.18);padding:10px;display:none}
    .popover.open{display:block}
    .theme-list{display:grid;gap:10px}
    .item{display:flex;align-items:center;gap:10px;padding:6px;border-radius:12px;border:1px solid var(--card-stroke);background:rgba(255,255,255,.7);cursor:pointer}
    .item:hover{filter:brightness(.98)}
    .dot{width:10px;height:10px;border-radius:50%;border:2px solid var(--card-stroke);background:transparent;margin-left:4px}
    .item.selected .dot{background:var(--dot);border-color:var(--dot)}
    .preview{flex:1;height:40px;border-radius:999px;border:1px solid rgba(0,0,0,.06);background:var(--sw,linear-gradient(90deg,#e6eef5,#c9d6e3,#aeb9c6));display:flex;align-items:center;justify-content:center}
    .preview .name{font-size:12px;color:#2b3640}

    @media(max-width:720px){.countdown{grid-template-columns:repeat(2,minmax(0,1fr))}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>国庆倒计时</h1>
      <button id="btn-theme" title="主题/颜色">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22a7 7 0 0 1 0-14 5 5 0 0 1 5 5 2 2 0 0 0 2 2h1a2 2 0 0 1 0 4h-1a7 7 0 0 1-7 3Z"/><circle cx="6.5" cy="12.5" r="1.5"/><circle cx="9.5" cy="7.5" r="1.5"/><circle cx="14.5" cy="7.5" r="1.5"/><circle cx="17.5" cy="12.5" r="1.5"/></svg>
        <span style="font-size:13px">主题</span>
      </button>
      <div class="popover" id="pop" role="listbox" aria-label="选择主题">
        <div class="theme-list" id="themeList"></div>
      </div>
    </header>

    <main class="card">
      <div class="topline">
        <div class="range">
          <div>开始：<strong id="startLabel"></strong></div>
          <div>结束：<strong id="endLabel"></strong></div>
        </div>
        <div class="badge" id="statusBadge">进行中</div>
      </div>

      <section class="countdown" aria-live="polite">
        <div class="unit"><div class="num" id="days">--</div><div class="label">天</div></div>
        <div class="unit"><div class="num" id="hours">--</div><div class="label">小时</div></div>
        <div class="unit"><div class="num" id="mins">--</div><div class="label">分钟</div></div>
        <div class="unit"><div class="num" id="secs">--</div><div class="label">秒</div></div>
      </section>

      <section class="progress">
        <div class="bar" aria-label="假期进度"><div class="fill" id="fill"></div></div>
        <div class="meta">
          <div>已过：<strong id="pct">0%</strong></div>
          <div>已用时：<strong id="elapsed">--</strong></div>
          <div>剩余：<strong id="remain">--</strong></div>
          <div>总时长：<strong id="total">--</strong></div>
        </div>
      </section>

      <section class="grid">
        <div class="panel">
          <h3 style="margin:0 0 10px;font-size:16px">假期流逝</h3>
          <div class="ring-wrap">
            <svg class="ring" viewBox="0 0 120 120" role="img" aria-label="假期流逝">
              <defs>
                <linearGradient id="g1" x1="0%" y1="0%" x2="100%" y2="0%">
                  <stop offset="0%" stop-color="#90a4ae"/>
                  <stop offset="100%" stop-color="#607d8b"/>
                </linearGradient>
              </defs>
              <circle cx="60" cy="60" r="52" stroke="rgba(0,0,0,.08)" stroke-width="12" fill="none" />
              <circle id="arc" cx="60" cy="60" r="52" stroke="url(#g1)" stroke-width="12" fill="none" stroke-linecap="round" stroke-dasharray="326.72" stroke-dashoffset="326.72" transform="rotate(-90 60 60)"/>
              <text id="ringText" x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-size="18">0%</text>
            </svg>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    'use strict';
    // —— 固定默认：北京时间（Asia/Shanghai, UTC+08:00） ——
    const MS=1, SEC=1000*MS, MIN=60*SEC, HOUR=60*MIN, DAY=24*HOUR;
    const SHANGHAI_OFFSET_MIN = 8*60; // +08:00 固定
    const toShanghaiNow = () => { const n=new Date(); const off=n.getTimezoneOffset(); const delta=(SHANGHAI_OFFSET_MIN+off)*MIN; return new Date(n.getTime()+delta); };
    const makeShanghaiDate=(y,m,d,hh=0,mm=0,ss=0)=> new Date(Date.UTC(y,m-1,d,hh-8,mm,ss));
    const pad=n=>String(n).padStart(2,'0');
    const fmtShanghai=(dt)=>{ const t=new Date(dt.getTime()+SHANGHAI_OFFSET_MIN*MIN); return `${t.getUTCFullYear()}-${pad(t.getUTCMonth()+1)}-${pad(t.getUTCDate())} ${pad(t.getUTCHours())}:${pad(t.getUTCMinutes())}:${pad(t.getUTCSeconds())}`; };

    // —— 固定区间：本年 9/30 00:00 → 10/08 23:59:59 ——
    const Y = new Date().getFullYear();
    const state={
      start: makeShanghaiDate(Y,9,30,0,0,0),
      end:   makeShanghaiDate(Y,10,8,23,59,59),
      theme: localStorage.getItem('n-theme')||'mist-blue'
    };

    // —— DOM ——
    const dEl=document.getElementById('days'), hEl=document.getElementById('hours'), mEl=document.getElementById('mins'), sEl=document.getElementById('secs');
    const pctEl=document.getElementById('pct'), fillEl=document.getElementById('fill');
    const startLabel=document.getElementById('startLabel'), endLabel=document.getElementById('endLabel');
    const elapsedEl=document.getElementById('elapsed'), remainEl=document.getElementById('remain'), totalEl=document.getElementById('total');
    const badge=document.getElementById('statusBadge');
    const arc=document.getElementById('arc'), ringText=document.getElementById('ringText');
    const btnTheme=document.getElementById('btn-theme');
    const pop=document.getElementById('pop');
    const themeList=document.getElementById('themeList');

    // —— 主题 ——
    const THEME_LIST=[
      {id:'mist-blue', name:'暮蓝雾霭',  colors:['#e6eef5','#c9d6e3','#aeb9c6']},
      {id:'sage',      name:'松釉青灰',  colors:['#e8efe9','#cfdad2','#b5c3bb']},
      {id:'peach-tea', name:'雾粉橙茶',  colors:['#f6edea','#e7d9cf','#d9c6ba']},
      {id:'ink-hill',  name:'墨兰远山',  colors:['#eef1f0','#d5dbd9','#bcc6c2']},
    ];

    function applyColors(a,b,c){ const r=document.documentElement.style; r.setProperty('--c1',a); r.setProperty('--c2',b); r.setProperty('--c3',c); }
    function applyTheme(id){
      const t=THEME_LIST.find(x=>x.id===id)||THEME_LIST[0];
      applyColors(...t.colors); state.theme=t.id; localStorage.setItem('n-theme',t.id);
      document.querySelectorAll('.item').forEach(it=> it.classList.toggle('selected', it.dataset.id===t.id));
    }

    function mountThemeList(){
      themeList.innerHTML='';
      THEME_LIST.forEach(t=>{
        const li=document.createElement('div'); li.className='item'; li.dataset.id=t.id; li.setAttribute('role','option');
        li.style.setProperty('--dot', t.colors[1]); // 小点颜色 = 主题中间色
        const dot=document.createElement('div'); dot.className='dot';
        const prev=document.createElement('div'); prev.className='preview'; prev.style.setProperty('--sw', `linear-gradient(90deg, ${t.colors.join(',')})`);
        const name=document.createElement('span'); name.className='name'; name.textContent=t.name; prev.appendChild(name);
        li.append(dot, prev);
        li.addEventListener('click', ()=>{ applyTheme(t.id); pop.classList.remove('open'); });
        themeList.appendChild(li);
      });
      applyTheme(localStorage.getItem('n-theme')||state.theme);
    }

    // 弹层定位与交互
    btnTheme.addEventListener('click', (e)=>{ e.stopPropagation(); pop.classList.toggle('open'); positionPop(); });
    function positionPop(){ const r=btnTheme.getBoundingClientRect(); const x=Math.max(8, r.right - (pop.offsetWidth||240)); const y=r.bottom + 10; pop.style.left=x+'px'; pop.style.top=y+'px'; }
    window.addEventListener('resize', ()=>{ if(pop.classList.contains('open')) positionPop(); });
    document.addEventListener('pointerdown', (e)=>{ if(!pop.contains(e.target) && !btnTheme.contains(e.target)) pop.classList.remove('open'); });

    // —— 工具 ——
    const fmtHM=ms=>{ const d=Math.floor(ms/DAY); ms-=d*DAY; const h=Math.floor(ms/HOUR); ms-=h*HOUR; const m=Math.floor(ms/MIN); ms-=m*MIN; const s=Math.floor(ms/SEC); return {d,h,m,s}; };
    const human=ms=>{ const {d,h,m,s}=fmtHM(Math.max(0,ms)); const p=[]; if(d) p.push(`${d}天`); if(h) p.push(`${h}小时`); if(m) p.push(`${m}分钟`); if(!d&&!h) p.push(`${s}秒`); return p.join(' '); };
    const clamp01=x=>Math.min(1,Math.max(0,x));

    // —— 更新 ——
    const ringLen=2*Math.PI*52;
    function update(){
      const nowSh=toShanghaiNow().getTime();
      const total=state.end-state.start; const elapsed=nowSh-state.start; const remain=state.end-nowSh;
      const {d,h,m,s}=fmtHM(remain); dEl.textContent=String(Math.max(0,d)).padStart(2,'0'); hEl.textContent=String(Math.max(0,h)).padStart(2,'0'); mEl.textContent=String(Math.max(0,m)).padStart(2,'0'); sEl.textContent=String(Math.max(0,s)).padStart(2,'0');
      const p=clamp01(elapsed/total); const pct=Math.round(p*1000)/10; fillEl.style.width=pct+'%'; pctEl.textContent=pct.toFixed(1)+'%'; const offset=ringLen*(1-p); arc.style.strokeDashoffset=String(offset); ringText.textContent=pct.toFixed(0)+'%';
      startLabel.textContent=fmtShanghai(state.start); endLabel.textContent=fmtShanghai(state.end);
      elapsedEl.textContent=elapsed<0?'未开始':human(elapsed); remainEl.textContent=remain<0?'已结束':human(remain); totalEl.textContent=human(total);
      badge.textContent = elapsed<0? '未开始' : remain<0? '已结束·收心' : '进行中';
    }

    // —— 启动 + 断言用例 ——
    (function(){
      mountThemeList(); update(); setInterval(update,500);
      // 自检
      console.assert(document.querySelector('h3').textContent.trim()==='假期流逝', '标题应为“假期流逝”');
      console.assert(!document.getElementById('ringCaption'), '不应存在圆环说明段落');
      console.assert(document.querySelectorAll('#btn-theme').length===1, '按钮唯一');
      console.assert(document.querySelectorAll('#pop').length===1, '弹层唯一');
      console.assert(document.querySelectorAll('.item').length===4, '应渲染 4 个主题项');
    })();
  </script>
</body>
</html>
